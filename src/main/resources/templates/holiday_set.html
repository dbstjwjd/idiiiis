<html layout:decorate="~{layout}">
<div layout:fragment="content" class="container" style="background: #fff;">
    <!-- 헤더 영역 -->
    <div class="header">
        <a href="/"><img src="/image/idis_logo.png" alt="" width="150" class="mt-2"></a>
        <h1>명절 선물 정보 입력</h1>
    </div>

    <!-- 폼 컨테이너 -->
    <div class="form-container">
        <form method="post" th:action="@{|/holiday/save/${person.id}|}" id="holidayForm" class="mt-4">
            <div style="width: 90%; margin: 0 auto;">
                <!-- 직원 정보 섹션 -->
                <div class="form-section">
                    <div class="form-section-title">직원 정보</div>
                    <!-- 부서 -->
                    <div class="form-row">
                        <div class="floating-label">
                            <input type="text" name="department" class="form-control" readonly placeholder=" "
                                   th:value="${person.department}">
                            <label>부서</label>
                        </div>
                    </div>
                    <!-- 사번 -->
                    <div class="form-row">
                        <div class="floating-label">
                            <input type="text" name="employeeNumber" class="form-control" readonly placeholder=" "
                                   th:value="${person.employeeNumber}">
                            <label>사번</label>
                        </div>
                    </div>
                    <!-- 이름 -->
                    <div class="form-row">
                        <div class="floating-label">
                            <input type="text" name="name" class="form-control" readonly placeholder=" "
                                   th:value="${person.name}">
                            <label>이름</label>
                        </div>
                    </div>
                </div>
                <!-- 배송 정보 섹션 -->
                <div class="form-section">
                    <div class="form-section-title">배송 정보</div>
                    <!-- 수령인 -->
                    <div class="form-row">
                        <div class="floating-label">
                            <input type="text" id="receiver" name="receiver" class="form-control" placeholder=" "
                                   th:value="${holiday != null ? holiday.receiver : ''}"/>
                            <label for="receiver">수령인</label>
                        </div>
                    </div>

                    <!-- 선물 선택 -->
                    <div class="form-row">
                        <div class="floating-label">
                            <select class="form-select" name="present" id="present" required>
                                <option value="" disabled th:selected="${holiday == null}" hidden></option>
                                <option th:each="present : ${presents}"
                                        th:value="${present.name()}"
                                        th:text="${present.value}"
                                        th:selected="${holiday != null && holiday.present == present.name()}">
                                </option>
                            </select>
                            <label for="present">선물</label>
                        </div>
                    </div>

                    <!-- 우편번호 -->
                    <div class="form-row">
                        <div class="floating-label input-group">
                            <input type="text" class="form-control" id="postCode" name="postCode" readonly
                                   placeholder=" " th:value="${holiday != null ? holiday.postCode : ''}"/>
                            <label for="postCode">우편번호</label>
                            <button class="but" type="button" id="searchBtn">우편번호 검색</button>
                        </div>
                    </div>

                    <!-- 기본 주소 -->
                    <div class="form-row">
                        <div class="floating-label">
                            <input type="text" class="form-control" id="address" name="address" readonly
                                   placeholder=" " th:value="${holiday != null ? holiday.address : ''}"/>
                            <label for="address">기본주소</label>
                        </div>
                    </div>

                    <!-- 상세 주소 -->
                    <div class="form-row">
                        <div class="floating-label">
                            <input type="text" class="form-control" id="detail" name="detail" placeholder=" "
                                   th:value="${holiday != null ? holiday.detail : ''}"/>
                            <label for="detail">상세주소</label>
                        </div>
                    </div>
                </div>
                <!-- 버튼 영역 -->
                <div class="button-container">
                    <button type="button" class="but_dark but" id="submitBtn">저장</button>
                </div>
            </div>
            <input type="hidden" name="personId" th:value="${person.id}">
        </form>
    </div>
    <script>
        $(document).ready(function () {
            $('#searchBtn').on('click', function () {
                new daum.Postcode({
                    oncomplete: function (data) {
                        $('#postCode').val(data.zonecode);
                        $('#address').val(data.roadAddress);
                    }
                }).open();
            });

            $('#submitBtn').on('click', function () {
                if ($('#receiver').val().trim() === '') {
                    showToast('수령인을 입력해주세요.', 'error');
                    $('html, body').animate({scrollTop: 0}, 500);
                } else if ($('#present').val() === null || $('#present').val() === '') {
                    showToast('선물을 선택해주세요.', 'error');
                    $('html, body').animate({scrollTop: 0}, 500);
                } else if ($('#postCode').val().trim() === '' || $('#address').val().trim() === '') {
                    showToast('주소를 입력해주세요.', 'error');
                    $('html, body').animate({scrollTop: 0}, 500);
                } else if ($('#detail').val().trim() === '') {
                    showToast('상세주소를 입력해주세요.', 'error');
                    $('html, body').animate({scrollTop: 0}, 500);
                } else {
                    showConfirmModal(
                        "배송정보를 저장하시겠습니까?",
                        function () {
                            $('#holidayForm').submit();
                        },
                        function () {
                            showToast("저장이 취소되었습니다.", "info");
                        }
                    );
                }
            });
        });
    </script>
</div>
</html>